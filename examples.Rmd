---
title: "Going Deeper with R Examples"
author: "David Keyes // R for the Rest of Us"
output: 
    html_document:
        css: css/style.css
        toc: true
        toc_depth: 1
        toc_float: true
        df_print: paged
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(readxl)
library(janitor)
library(skimr)
```


# Advanced Data Wrangling and Analysis

Start with Overall Project Structuring (doing cleaning in .R + reporting in Rmd)

## Importing Data

Download file manually and put it in folder

Talk about how doing so requires you to re-download each time

Download file using download.file()

Import Excel files using read_excel()

```{r}
math_scores <- read_excel("data/math-scores.xlsx") %>% 
                          # na = c("--", "*", "< 5.0%", "> 95.0%")) %>% 
    clean_names()
```


Talk about importing SPSS etc using haven or Rio



## Tidy data

Start with problem (e.g. can't plot non-tidy data)


## Reshaping data

```{r}
math_scores %>% 
    filter(student_group == "Total Population (All Students)") %>% 
    filter(grade_level == "Grade 3") %>% 
    select(school_id, contains("percent")) %>% 
    pivot_longer(cols = -c(school_id)) %>% 
    mutate(value = na_if(value, "--"))
```


## Additional functions for data tidying

separate() + separate_rows() + bind_rows() + bind_cols() but not sure if they work with my data




## Dealing with missing data

Going from value to NA (na_if): do it by not using na argument in read_excel above


and back (replace_na): just show example (not actually going to use it going forward)



## Changing variable types

Convert various numeric types that are character because of weird NAs

```{r}
math_scores %>% 
    skim()
```


## Advanced variable creation

if_else + recode + case_when


## Merging data

Merge attendance data with math scores data

## Renaming variables



## Exporting data

write_csv()
write_rds()
rio::export()


# Advanced RMarkdown

## Tables

Setting df_print in YAML
gt
kable + kableExtra
formattable
DT
reactable
flextable

## Inline R code



## Advanced markdown text formatting

Links
Images
Block quotes
Footnotes
https://github.com/ThinkR-open/remedy

## Advanced YAML

TOC: true/false, depth, floating
df_print
custom css
ymlthis package as way to simplify it
https://ymlthis.r-lib.org/articles/yaml-fieldguide.html

https://bookdown.org/yihui/rmarkdown/html-document.html

## Advanced code chunk options

fig.align
fig.width + fig.height 
out.width, out.height
fig.cap
dpi
https://yihui.org/knitr/options/

## Making your reports shine: HTML edition

pretty RMarkdown templates, pagedown, custom css

## Making your reports look nice: Word edition

Using reference docs

## Making your reports look nice: PDF edition

Don't use LaTeX

https://twitter.com/andrewheiss/status/1204870408148832257

## Presentations

PPT
xaringan


## Dashboards

flexdashboard


## Parameterized reporting

TK: Take out?
https://medium.com/@urban_institute/iterated-fact-sheets-with-r-markdown-d685eb4eafce

# Advanced Data Visualization

## Applying best practice to data viz

## Ordering in plots

Use reorder first, then use factors

## Using color to highlight

Do it manually first

Then do it with gghighlight

## Adding labels directly to plots

Use scales package to show percentages on plots

ggrepel on scatterplot showing association between scores and attendance data

## Annotations

Add FT tweet from 1/23/20 from John Murdoch to show it
http://www.thefunctionalart.com/2020/01/an-example-of-how-to-annotate.html

## Using themes

Actual themes
- Use hrbrthemes + show various options
- Link to themes RRU blog post

theme() function <- use this as place to demonstrate user-made functions

## Using custom fonts

Plotting + saving (i.e. use device = cairo_pdf)

https://www.andrewheiss.com/blog/2017/09/27/working-with-r-cairo-graphics-custom-fonts-and-ggplot/


## Unique data viz options in R (aka a tour of ggplot extensions)

- gganimate
- ggridges
- https://github.com/corybrunson/ggalluvial
- [ggalt](https://github.com/hrbrmstr/ggalt) (lollipops, dumbells, etc.)
- [ggbeeswarm](https://github.com/eclarke/ggbeeswarm)
- https://ggraph.data-imaginist.com/
- https://github.com/ricardo-bion/ggradar
- https://github.com/econandrew/ggtreemap
- https://github.com/hrbrmstr/waffle

Collections
- http://www.ggplot2-exts.org/gallery/
- [From Data to Viz](https://www.data-to-viz.com/)


